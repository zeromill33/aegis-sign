# Status
Draft

# Story
**As a** 网关/路由组件维护者
**I want** 实现 `keyId → enclave` 一致性哈希粘性路由
**so that** 提升缓存命中率，降低跨 Enclave 命中与冷启动。

# Acceptance Criteria
1. 缓存命中率 > 95%；跨 Enclave 命中率 < 5%
2. 支持虚拟节点、在线变更；异常 Enclave 可健康摘除/恢复
3. 支持灰度迁移（平滑迁移少量 keyId）
4. 可观测：`sticky_hit_rate`, `cross_enclave_route_total`

# Tasks / Subtasks
- [ ] 哈希环实现（AC: 1,2）
  - [ ] 虚拟节点；在线增删；健康摘除/恢复
- [ ] 灰度迁移（AC: 3）
  - [ ] 百分比迁移/白名单迁移
- [ ] 指标与日志（AC: 4）
- [ ] 测试
  - [ ] 命中率评估与跨 Enclave 率评估

# Dev Notes
- 来源：docs/bmad-stories-create-sign.md S9
- 与 S2 连接池抽象集成，统一父机维度路由/连接管理

## Testing
- 随机分布 keyId 的一致性与变更扰动测试

# Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-19 | v1 | 初始创建 | PM |

# Dev Agent Record

