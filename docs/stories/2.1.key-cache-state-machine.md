# Status
Draft

# Story
**As a** 签名服务后端工程师
**I want** 实现 WARM/COOL/INVALID 状态机与 TTL/Uses 语义
**so that** PlainKey 过期/用尽不触发 KMS，DEK 有效时本地再水合，稳定热路径。

# Acceptance Criteria
1. WARM：直接签名；COOL：本地再水合成功率 > 99.5%；INVALID：热路径不等待 KMS
2. `hard_expired_rejections_total ≈ 0`（演练除外）
3. Entry 结构包含：`Priv32, UsesLeft, SoftTTL, HardTTL, DEK.ValidUntil`
4. 到期清零与原子状态切换正确；密文 Blob 在 Enclave 保持只读副本
5. 指标：`key_cache_state{WARM|COOL|INVALID}`

# Tasks / Subtasks
- [ ] 设计与实现状态机（AC: 1,3,4）
- [ ] 本地再水合逻辑（AC: 1）
- [ ] 只读密文副本管理（AC: 4）
- [ ] 指标与日志（AC: 5）
- [ ] 测试：状态迁移/极端边界（AC: 1,2,4）

# Dev Notes
- 来源：docs/bmad-stories-create-sign.md S3
- 为 S4 单航班刷新与 S5 异步解锁提供基础

## Testing
- 单元测试：状态迁移、TTL/Uses 边界；集成：再水合成功率

# Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-19 | v1 | 初始创建 | PM |

# Dev Agent Record

