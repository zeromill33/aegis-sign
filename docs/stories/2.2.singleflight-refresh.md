# Status
Draft

# Story
**As a** 签名服务后端工程师
**I want** 在 soft/hard 过期时启用单航班刷新（single-flight）
**so that** 避免羊群效应/击穿并控制 p99。

# Acceptance Criteria
1. soft 过期：允许签名，同时触发后台 single-flight 刷新
2. hard 过期：≤ 3ms 完成再水合；超时立即返回 UNLOCK_REQUIRED
3. `rehydrate_latency_ms p95 < 2ms`；`NEEDS_UNLOCK_rate < 0.5%`
4. 指标：`rehydrate_total/fail/latency_ms`, `singleflight_waiters`

# Tasks / Subtasks
- [ ] per-key single-flight（AC: 1,4）
- [ ] signWaitBudget=2–3ms 的等待策略（AC: 2,3）
- [ ] 预刷新器：`refreshWindow=2m`、`lowWaterMark=500 uses`、`jitter=±10%`（AC: 3）
- [ ] 测试：冲击流量与过期边界（AC: 1,2,3）

# Dev Notes
- 来源：docs/bmad-stories-create-sign.md S4
- 与 S3 状态机、S5 异步解锁协同

## Testing
- 压测下的刷新等待预算与 p95 验证

# Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-19 | v1 | 初始创建 | PM |

# Dev Agent Record

