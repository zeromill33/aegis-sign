# Status
Draft

# Story
**As a** 后端工程团队
**I want** 网关→Enclave 使用 gRPC/HTTP2 长连接（优先双向流式）
**so that** 消除建连/队首阻塞长尾，稳定 sign 延迟。

# Acceptance Criteria
1. 每个 Enclave 维持 16–32 条长连接，开启 KeepAlive/健康探测；断线重连 < 200ms
2. sign p99 不包含连接建连开销；无流复用 HOL 问题
3. 暴露连接相关指标：`active_conns`, `grpc_stream_resets`, `pool_acquire_latency_ms`

# Tasks / Subtasks
- [ ] 连接池实现（并发安全）（AC: 1,2）
  - [ ] 支持 MaxConcurrentStreams、deadline、心跳/KeepAlive
  - [ ] 指数退避的断线重连
- [ ] 健康探测/熔断（AC: 1,2）
  - [ ] 异常分级与池内摘除/恢复策略
- [ ] 指标与日志（AC: 3）
  - [ ] active_conns、pool_acquire_latency_ms 直方图
  - [ ] grpc_stream_resets 计数
- [ ] 测试
  - [ ] 压力下连接池枯竭不发生（模拟）
  - [ ] 重连时延 < 200ms

# Dev Notes
- 来源：docs/bmad-stories-create-sign.md S2
- 建议：在父机维度统一连接池抽象，按 Enclave 目标做分片，以便后续 S9 粘性路由接入

## Testing
- 连接池单元测试 + 健康探测集成测试

# Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-19 | v1 | 初始创建 | PM |

# Dev Agent Record

